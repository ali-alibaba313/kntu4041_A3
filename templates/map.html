<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ù‚Ø´Ù‡ WebGIS</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡ Identify - Ú†Ù¾ Ù¾Ø§ÛŒÛŒÙ† */
        .identify-control {
            position: absolute;
            bottom: 30px;
            left: 10px;
            z-index: 1000;
        }
        
        .identify-btn {
            background: white;
            border: 2px solid rgba(0,0,0,0.2);
            border-radius: 4px;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 1px 5px rgba(0,0,0,0.4);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .identify-btn:hover {
            background: #f4f4f4;
        }
        
        .identify-btn.active {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª */
        .feature-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .feature-table thead {
            background: #f5f5f5;
        }
        
        .feature-table th,
        .feature-table td {
            padding: 8px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }
        
        .feature-table th {
            font-weight: bold;
            color: #333;
        }
        
        .feature-table tbody tr:hover {
            background: #f9f9f9;
        }
        
        .hint {
            color: #666;
            font-style: italic;
            padding: 10px;
            text-align: center;
        }
        
        .error {
            color: #d32f2f;
            padding: 10px;
            text-align: center;
            background: #ffebee;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="map-header">
        <h1>ğŸ—ºï¸ Ø³ÛŒØ³ØªÙ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¬ØºØ±Ø§ÙÛŒØ§ÛŒÛŒ ÙˆØ¨</h1>
        <div class="user-info">
            <span>Ú©Ø§Ø±Ø¨Ø±: {{ username }}</span>
            <a href="/logout" class="logout-btn">Ø®Ø±ÙˆØ¬</a>
        </div>
    </div>

    <!-- Toolbar (Ø¨Ø§Ù„Ø§ Ø±Ø§Ø³Øª) -->
    <div class="toolbar">
        <button onclick="toggleMenu()" class="menu-btn">â˜° Ù…Ù†Ùˆ</button>
        <div id="dropdown-menu" class="dropdown-menu">
            <button onclick="showAddLayerDialog()">â• Ø§ÙØ²ÙˆØ¯Ù† Ù„Ø§ÛŒÙ‡ WMS</button>
            <button onclick="map.setView([35.6892, 51.3890], 11)">ğŸ  Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ø±Ú©Ø²</button>
            <button onclick="clearDrawnItems()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø±Ø³Ù…â€ŒÙ‡Ø§</button>
        </div>
    </div>

    <!-- Ø¯Ú©Ù…Ù‡ Identify (Ú†Ù¾-Ù¾Ø§ÛŒÛŒÙ†) âœ… -->
    <div class="identify-control">
        <button id="identify-btn" class="identify-btn" onclick="toggleIdentify()" title="Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¹Ø§Ø±Ø¶Ù‡ (GetFeatureInfo)">
            ğŸ”
        </button>
    </div>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Feature Info Panel -->
    <div id="feature-info-panel" class="feature-info-panel">
        <div class="panel-header">
            <h4>ğŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¹Ø§Ø±Ø¶Ù‡</h4>
            <button onclick="closeFeatureInfo()" class="close-btn">âœ–</button>
        </div>
        <div id="feature-info-content" class="panel-content">
            <p class="hint">Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ ğŸ” Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ Ùˆ Ø³Ù¾Ø³ Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯</p>
        </div>
    </div>

    <!-- Add Layer Dialog -->
    <div id="add-layer-dialog" class="dialog-overlay">
        <div class="dialog-box">
            <div class="dialog-header">
                <h3>Ø§ÙØ²ÙˆØ¯Ù† Ù„Ø§ÛŒÙ‡ WMS</h3>
                <button onclick="closeAddLayerDialog()" class="close-btn">âœ–</button>
            </div>
            <div class="dialog-content">
                <label>Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ± WMS:</label>
                <input type="text" id="wms-url" placeholder="http://localhost:8080/geoserver/wms" value="http://localhost:8080/geoserver/wms">
                
                <label>Ù†Ø§Ù… Ù„Ø§ÛŒÙ‡ (workspace:layer):</label>
                <input type="text" id="layer-name" placeholder="topp:states">
                
                <label>Ù†Ø§Ù… Ù†Ù…Ø§ÛŒØ´ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                <input type="text" id="layer-display-name" placeholder="Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø±ÛŒÚ©Ø§">
                
                <div class="dialog-actions">
                    <button onclick="addCustomWMSLayer()" class="btn-primary">Ø§ÙØ²ÙˆØ¯Ù† Ù„Ø§ÛŒÙ‡</button>
                    <button onclick="closeAddLayerDialog()" class="btn-secondary">Ø§Ù†ØµØ±Ø§Ù</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="{{ url_for('static', filename='js/map.js') }}"></script>
</body>
</html>
